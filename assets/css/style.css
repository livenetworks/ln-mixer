/* ==========================================================================
   LN DJ Mixer — v2 Dual-Deck Layout
   Single CSS file: tokens, icons, layout, components
   ========================================================================== */

/* ==========================================================================
   1. CUSTOM PROPERTIES (Design Tokens)
   ========================================================================== */

:root {
	/* Surfaces */
	--bg: #111;
	--surface: #1a1a1a;
	--surface-raised: #222;
	--surface-sunken: #181818;

	/* Text */
	--text: #eee;
	--text-muted: #999;
	--text-dim: #666;
	--highlight: #ffa;

	/* Accent — HSL values (orange); override in .deck--b for blue */
	--accent: 39 100% 50%;
	--accent-active: 32 100% 50%;

	/* Functional colors — HSL values */
	--cue: 0 100% 63%;
	--loop: 153 55% 53%;

	/* Interactive */
	--track-bg: #333;
	--button-bg: #333;
	--button-hover: #444;
	--button-border: #444;
	--border-color: #2a2a2a;
	--input-bg: #2a2a2a;
	--input-border: #444;

	/* Spacing */
	--gap-xs: 0.25rem;
	--gap-sm: 0.5rem;
	--gap-md: 1rem;
	--gap-lg: 1.5rem;
	--gap-xl: 2rem;

	/* Sizing */
	--topbar-height: 56px;
	--waveform-height: 100px;
	--touch-min: 44px;
	--radius: 6px;
	--radius-sm: 4px;

	/* Typography */
	--font-main: system-ui, -apple-system, sans-serif;
	--font-mono: 'Courier New', monospace;

	/* Transitions */
	--transition-fast: 0.15s ease;
	--transition-base: 0.25s ease;

	/* ln-acme token mapping (consumed by ln-acme-modal.css, ln-acme-toast.css) */
	--color-bg-primary: var(--surface);
	--color-bg-secondary: var(--surface-raised);
	--color-bg-body: var(--bg);
	--color-border: var(--border-color);
	--color-text-primary: var(--text);
	--color-text-muted: var(--text-muted);
	--color-primary: hsl(var(--accent));
	--color-primary-hover: hsl(var(--accent-active));
	--color-primary-light: hsl(var(--accent) / 0.15);
	--color-error: #dc2626;
	--color-error-hover: #b91c1c;
	--z-modal: 1000;
	--radius-md: var(--radius);
	--shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
	--spacing-lg: var(--gap-lg);
	--spacing-sm: var(--gap-sm);
	--text-base: 1rem;
	--font-semibold: 600;
}

/* ==========================================================================
   3. RESET & BASE
   ========================================================================== */

* {
	box-sizing: border-box;
}

body {
	margin: 0;
	background: var(--bg);
	color: var(--text);
	font-family: var(--font-main);
	font-size: 14px;
	line-height: 1.4;
	overflow: hidden;
}

h1, h2, h3, h4, h5, h6 {
	margin: 0;
	font-weight: 600;
}

ul, ol {
	list-style: none;
	padding: 0;
	margin: 0;
}

p {
	margin: 0;
}

fieldset {
	border: none;
	margin: 0;
	padding: 0;
}

/* ==========================================================================
   4. LAYOUT
   ========================================================================== */

.player {
	display: grid;
	grid-template-rows: var(--topbar-height) 1fr;
	height: 100vh;
	overflow: hidden;
	position: relative;
}

/* --- Global Download Progress Bar --- */

.global-progress {
	position: absolute;
	top: var(--topbar-height);
	left: 0;
	right: 0;
	height: 4px;
	z-index: 10;
	background: var(--track-bg);
	overflow: hidden;
	margin: 0;
	pointer-events: none;
}

.global-progress > [data-ln-progress] {
	display: block;
	height: 100%;
	width: 0;
	background: hsl(var(--accent));
	border-radius: 0;
	transition: width 0.15s ease;
}

/* --- Topbar --- */

.topbar {
	display: flex;
	align-items: center;
	gap: var(--gap-lg);
	padding: 0 var(--gap-md);
	background: var(--surface);
	border-bottom: 1px solid var(--border-color);
}

.topbar-left {
	display: flex;
	align-items: center;
	gap: var(--gap-sm);
}

/* --- Profile Bar --- */

.profile-bar {
	display: flex;
	align-items: center;
	gap: var(--gap-xs);
	overflow-x: auto;
	flex-shrink: 1;
	min-width: 0;
	-webkit-overflow-scrolling: touch;
	scrollbar-width: none;
}

.profile-bar::-webkit-scrollbar {
	display: none;
}

.profile-btn {
	padding: 0.3rem 0.75rem;
	font-size: 0.7rem;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.04em;
	border-radius: 99px;
	background: transparent;
	border: 1px solid var(--button-border);
	color: var(--text-muted);
	white-space: nowrap;
	transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast);
}

.profile-btn:hover {
	background: rgba(255, 255, 255, 0.06);
	color: var(--text);
}

.profile-btn.active {
	background: hsl(var(--accent));
	color: #000;
	border-color: hsl(var(--accent));
	font-weight: 700;
}

.profile-add {
	padding: 0.25rem;
	background: transparent;
	border: 1px dashed var(--button-border);
	border-radius: 50%;
	color: var(--text-dim);
	min-width: 28px;
	min-height: 28px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	flex-shrink: 0;
}

.profile-add:hover {
	border-color: hsl(var(--accent));
	color: hsl(var(--accent));
}

.volume-control {
	display: flex;
	align-items: center;
	gap: var(--gap-sm);
	margin-left: auto;
}

.volume-control input[type="range"] {
	-webkit-appearance: none;
	width: 120px;
	height: 4px;
	background: var(--track-bg);
	border-radius: 2px;
	outline: none;
	cursor: pointer;
}

.volume-control input[type="range"]::-webkit-slider-thumb {
	-webkit-appearance: none;
	width: 16px;
	height: 16px;
	border-radius: 50%;
	background: hsl(var(--accent));
	cursor: pointer;
}

.topbar-actions {
	display: flex;
	gap: var(--gap-sm);
}

/* --- Main Area --- */

.main-area {
	display: grid;
	grid-template-columns: 1fr 30%;
	overflow: hidden;
}

/* --- Empty State --- */

.empty-state {
	grid-column: 1 / -1;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: var(--gap-md);
	padding: var(--gap-xl);
	text-align: center;
	color: var(--text-muted);
}

.empty-state-icon {
	width: 64px;
	height: 64px;
	border-radius: 50%;
	background: var(--surface-raised);
	display: flex;
	align-items: center;
	justify-content: center;
	margin: 0;
}

.empty-state-icon .ln-icon-add::before {
	width: 32px;
	height: 32px;
	opacity: 0.5;
}

.empty-state h2 {
	font-size: 1.25rem;
	color: var(--text);
	margin: 0;
}

.empty-state p {
	font-size: 0.9rem;
	margin: 0;
}

.empty-state-btn {
	display: inline-flex;
	align-items: center;
	gap: 0.4rem;
	padding: 0.75rem 1.5rem;
	background: hsl(var(--accent));
	color: var(--bg);
	border: none;
	border-radius: var(--radius);
	font-size: 0.95rem;
	font-weight: 600;
	cursor: pointer;
	touch-action: manipulation;
	min-height: 48px;
}

.empty-state-btn:hover {
	filter: brightness(1.1);
}

.empty-state-btn .ln-icon-add::before {
	filter: brightness(0);
}

/* ==========================================================================
   5. DECKS PANEL (left)
   ========================================================================== */

.decks-panel {
	display: flex;
	flex-direction: column;
	gap: 2px;
	overflow-y: auto;
	background: var(--border-color);
}

/* --- Individual Deck --- */

.deck {
	--deck-color: hsl(var(--accent));
	display: flex;
	flex-direction: column;
	gap: var(--gap-sm);
	padding: var(--gap-md) var(--gap-lg);
	background: var(--surface);
	flex: 1;
	min-height: 0;
}

.deck--b {
	--accent: 210 100% 63%;
	--deck-color: hsl(var(--accent));
}

.deck-header {
	display: flex;
	align-items: center;
	gap: var(--gap-sm);
}

.deck-header h2 {
	font-size: 0.75rem;
	text-transform: uppercase;
	letter-spacing: 0.1em;
	color: var(--text-muted);
}

.deck-badge {
	font-size: 0.6rem;
	text-transform: uppercase;
	letter-spacing: 0.08em;
	padding: 0.15rem 0.5rem;
	border-radius: 2px;
	background: hsl(var(--accent) /0.15);
	color: hsl(var(--accent));
	font-weight: 700;
}

/* --- Track Info in Deck --- */

.deck .track-title {
	font-size: 1.2rem;
	font-weight: 700;
	color: var(--highlight);
}

.deck--b .track-title {
	color: var(--text);
}

.deck .track-artist {
	font-size: 0.875rem;
	color: var(--text-muted);
	margin-top: -0.25rem;
}

/* --- Waveform --- */

.waveform {
	position: relative;
	height: calc(var(--waveform-height) + 20px);
	background:
		repeating-linear-gradient(
			90deg,
			transparent, transparent 2px,
			rgba(255,255,255,0.03) 2px, rgba(255,255,255,0.03) 4px
		),
		linear-gradient(
			90deg,
			#2a2a3a 0%, #3a3a5a 8%, #4a4a6a 15%, #3a3a5a 22%,
			#5a5a7a 30%, #4a4a6a 38%, #3a3a5a 45%, #5a5a7a 52%,
			#6a6a8a 58%, #4a4a6a 65%, #3a3a5a 72%, #5a5a7a 80%,
			#4a4a6a 88%, #3a3a5a 95%, #2a2a3a 100%
		);
	border-radius: var(--radius);
	overflow: hidden;
	margin: 0;
	cursor: pointer;
}

.waveform--loaded {
	background: none;
}

.waveform-progress {
	position: absolute;
	inset: 0;
	z-index: 2;
	background: hsl(var(--accent) /0.08);
	pointer-events: none;
	transition: width 0.1s linear;
}

.waveform-playhead {
	position: absolute;
	top: 0;
	bottom: 0;
	z-index: 2;
	width: 2px;
	background: #fff;
	box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
	pointer-events: none;
	transition: left 0.1s linear;
}

.cue-marker {
	position: absolute;
	top: 0;
	bottom: 0;
	z-index: 2;
	width: 2px;
	pointer-events: none;
}

.cue-marker--start { background: hsl(var(--cue)); }
.cue-marker--end { background: hsl(var(--cue)); opacity: 0.6; }

.cue-region {
	position: absolute;
	top: 0;
	bottom: 0;
	z-index: 2;
	background: hsl(var(--cue) /0.15);
	pointer-events: none;
}

.cue-marker--pending {
	background: hsl(var(--cue));
	opacity: 0.8;
	animation: cue-pulse 1s ease-in-out infinite;
}

@keyframes cue-pulse {
	0%, 100% { opacity: 0.8; }
	50% { opacity: 0.3; }
}

/* --- Waveform Container + Zoom --- */

.waveform-container {
	position: relative;
	border: 0;
	padding: 0;
	margin: 0;
	overflow: visible;
	min-width: 0;
}

.waveform--zoomed {
	overflow-x: auto;
	overflow-y: hidden;
	-webkit-overflow-scrolling: touch;
}

.waveform--zoomed::-webkit-scrollbar {
	height: 4px;
}

.waveform--zoomed::-webkit-scrollbar-track {
	background: transparent;
}

.waveform--zoomed::-webkit-scrollbar-thumb {
	background: rgba(255, 255, 255, 0.2);
	border-radius: 2px;
}

.waveform-zoom {
	position: absolute;
	top: var(--gap-xs);
	right: var(--gap-xs);
	z-index: 5;
	display: flex;
	gap: 2px;
	opacity: 0.4;
	transition: opacity var(--transition-fast);
}

.waveform-container:hover .waveform-zoom,
.waveform-zoom:focus-within {
	opacity: 1;
}

.waveform-zoom button {
	min-width: var(--touch-min);
	min-height: var(--touch-min);
	padding: 2px;
	background: rgba(0, 0, 0, 0.6);
	border-radius: var(--radius);
	touch-action: manipulation;
}

/* --- Waveform Timeline Ruler --- */

.waveform-timeline {
	position: absolute;
	top: var(--waveform-height);
	left: 0;
	width: 100%;
	height: 20px;
	pointer-events: none;
	z-index: 3;
}

.waveform-tick {
	position: absolute;
	bottom: 0;
	width: 1px;
	background: rgba(255, 255, 255, 0.15);
}

.waveform-tick--minor {
	height: 5px;
}

.waveform-tick--major {
	height: 10px;
	background: rgba(255, 255, 255, 0.3);
}

.waveform-tick--major::after {
	content: attr(data-time);
	position: absolute;
	top: 0;
	left: 2px;
	font-size: 0.65rem;
	font-family: var(--font-mono);
	color: var(--text-dim);
	white-space: nowrap;
}

/* --- Time Display --- */

.time-display {
	display: flex;
	align-items: center;
	gap: var(--gap-xs);
	font-family: var(--font-mono);
	font-size: 1.25rem;
	color: var(--text);
	font-variant-numeric: tabular-nums;
}

.time-display .time-separator {
	color: var(--text-dim);
	font-size: 1rem;
}

.time-display .time-total {
	color: var(--text-muted);
	font-size: 1rem;
}

/* --- Transport Controls --- */

.controls {
	display: flex;
	gap: var(--gap-sm);
	flex-wrap: wrap;
}

/* ==========================================================================
   6. SIDEBAR (right panel)
   ========================================================================== */

.sidebar {
	background: var(--surface-sunken);
	border-left: 1px solid var(--border-color);
	display: flex;
	flex-direction: column;
	overflow-y: auto;
}

/* --- Playlist Accordion --- */

.playlist-group {
	border-bottom: 1px solid var(--border-color);
}

.playlist-group > header {
	display: flex;
	align-items: center;
	padding: var(--gap-sm) var(--gap-md);
	font-size: 0.8rem;
	font-weight: 700;
	text-transform: uppercase;
	letter-spacing: 0.06em;
	color: var(--text-muted);
	cursor: pointer;
	user-select: none;
	touch-action: manipulation;
	min-height: var(--touch-min);
	transition: background var(--transition-fast), color var(--transition-fast);
}

.playlist-group > header:hover {
	background: rgba(255, 255, 255, 0.04);
}

.playlist-group.open > header {
	color: hsl(var(--accent));
	background: hsl(var(--accent) /0.15);
}

.playlist-group > header::before {
	content: '';
	display: inline-block;
	width: 0.75rem;
	height: 0.75rem;
	margin-right: var(--gap-sm);
	background-image: var(--icon-chevron-down-white);
	background-size: contain;
	background-repeat: no-repeat;
	background-position: center;
	transition: transform var(--transition-fast);
	flex-shrink: 0;
}

.playlist-group:not(.open) > header::before {
	transform: rotate(-90deg);
}

.playlist-group > .track-list {
	display: none;
}

.playlist-group.open > .track-list {
	display: block;
}

/* --- Sidebar Footer --- */

.sidebar-footer {
	margin-top: auto;
	padding: var(--gap-sm) var(--gap-md);
	border-top: 1px solid var(--border-color);
}

/* --- Track List --- */

.track-list {
	overflow-y: auto;
}

.track-list > li {
	position: relative;
	overflow: hidden;
	border-bottom: 1px solid var(--border-color);
	transition: background var(--transition-fast);
}

.track-content {
	position: relative;
	z-index: 1;
	display: grid;
	grid-template-columns: 1.5rem 1fr auto;
	grid-template-rows: auto auto;
	column-gap: var(--gap-sm);
	row-gap: 2px;
	padding: var(--gap-sm) var(--gap-md);
	background: var(--surface-sunken);
	align-items: center;
}

/* Row 1: number+drag | title + artist + duration | [A][B]
   Row 2:             | notes + indicators        |       */

/* --- Track Number + Drag Handle (combined) --- */

.track-number {
	grid-column: 1;
	grid-row: 1 / -1;
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 2px;
	font-size: 0.8rem;
	color: var(--text-dim);
	text-align: center;
	cursor: grab;
	touch-action: none;
	padding: 2px 0;
}

.track-number::after {
	content: '';
	display: block;
	width: 0.75rem;
	height: 0.75rem;
	background-image: var(--icon-drag-white);
	background-size: contain;
	background-repeat: no-repeat;
	background-position: center;
	opacity: 0.4;
	transition: opacity var(--transition-fast);
}

.track-list > li:hover .track-number::after {
	opacity: 0.8;
}

.track-number:active {
	cursor: grabbing;
}

/* Dragging state (ln-sortable component) */
.track-list > li.ln-sortable--dragging {
	opacity: 0.4;
}

.track-list > li.ln-sortable--dragging > .track-content {
	background: var(--surface);
}

/* Drop indicator line (ln-sortable component) */
.track-list > li.ln-sortable--drop-before {
	box-shadow: inset 0 2px 0 0 hsl(var(--accent));
}

.track-list > li.ln-sortable--drop-after {
	box-shadow: inset 0 -2px 0 0 hsl(var(--accent));
}

.track-info {
	grid-column: 2;
	grid-row: 1;
	display: flex;
	align-items: baseline;
	gap: var(--gap-sm);
	min-width: 0;
}

.track-name {
	font-size: 0.875rem;
	font-weight: 600;
	color: var(--text);
}

.track-info .track-artist {
	font-size: 0.75rem;
	color: var(--text-muted);
	white-space: nowrap;
}

.track-duration {
	font-size: 0.75rem;
	color: var(--text-dim);
	font-family: var(--font-mono);
	margin-left: auto;
	white-space: nowrap;
}

.track-meta-row {
	grid-column: 2;
	grid-row: 2;
	display: flex;
	align-items: center;
	gap: var(--gap-sm);
	min-width: 0;
}

.track-notes {
	font-size: 0.7rem;
	color: var(--text-dim);
	font-style: italic;
}

/* --- Edit Track Dialog --- */

.edit-track-title {
	font-size: 1rem;
	font-weight: 600;
	color: var(--text);
}

.edit-track-artist {
	font-size: 0.85rem;
	color: var(--text-muted);
	margin-bottom: var(--gap-md);
}

.track-indicators {
	display: flex;
	align-items: center;
	gap: var(--gap-xs);
	flex-shrink: 0;
}

.indicator-loop {
	color: hsl(var(--loop));
}

.indicator-loop::before {
	width: 0.875rem;
	height: 0.875rem;
	filter: hue-rotate(100deg) brightness(1.5);
}

.loop-count-badge {
	font-size: 0.6rem;
	color: hsl(var(--loop));
	font-family: var(--font-mono);
	background: hsl(var(--loop) /0.1);
	padding: 0.1rem 0.3rem;
	border-radius: 2px;
}

/* Active on Deck A */
.track-list > li.active-a > .track-content {
	background: hsl(var(--accent) /0.15);
	border-left: 3px solid hsl(var(--accent));
}

.track-list > li.active-a .track-name {
	color: hsl(var(--accent));
}

.track-list .active-a .track-number {
	color: hsl(var(--accent));
	font-weight: 700;
}

/* Active on Deck B */
.track-list > li.active-b > .track-content {
	background: hsl(210 100% 63% / 0.15);
	border-left: 3px solid hsl(210 100% 63%);
}

.track-list > li.active-b .track-name {
	color: hsl(210 100% 63%);
}

.track-list .active-b .track-number {
	color: hsl(210 100% 63%);
	font-weight: 700;
}

/* Both decks on same track */
.track-list > li.active-a.active-b > .track-content {
	background: linear-gradient(90deg, hsl(var(--accent) / 0.15), hsl(210 100% 63% / 0.15));
	border-left: 3px solid hsl(var(--accent));
}

/* --- Load-to-Deck Buttons in Sidebar --- */

.track-load-actions {
	grid-column: 3;
	grid-row: 1 / -1;
	display: flex;
	gap: var(--gap-sm);
	align-self: center;
}

.load-btn {
	min-width: 48px;
	min-height: 48px;
	padding: 0;
	font-size: 1rem;
	font-weight: 800;
	border-radius: var(--radius);
	display: inline-flex;
	align-items: center;
	justify-content: center;
	transition: background var(--transition-fast), transform 0.1s ease;
}

.load-btn:active {
	transform: scale(0.92);
}

.load-btn--a {
	background: hsl(var(--accent) /0.15);
	border: 2px solid hsl(var(--accent));
	color: hsl(var(--accent));
}

.load-btn--a:hover {
	background: hsl(var(--accent) /0.3);
}

.load-btn--a.load-btn--loaded {
	background: hsl(var(--accent));
	color: #000;
	cursor: default;
	pointer-events: none;
}

.load-btn--b {
	background: hsl(210 100% 63% / 0.15);
	border: 2px solid hsl(210 100% 63%);
	color: hsl(210 100% 63%);
}

.load-btn--b:hover {
	background: hsl(210 100% 63% / 0.3);
}

.load-btn--b.load-btn--loaded {
	background: hsl(210 100% 63%);
	color: #000;
	cursor: default;
	pointer-events: none;
}

/* ==========================================================================
   7. BUTTONS
   ========================================================================== */

button {
	background: var(--button-bg);
	border: 1px solid var(--button-border);
	color: var(--text);
	padding: 0.5rem 1rem;
	cursor: pointer;
	font-size: 0.875rem;
	font-family: var(--font-main);
	border-radius: var(--radius-sm);
	display: inline-flex;
	align-items: center;
	gap: 0.4rem;
	transition: background var(--transition-fast), border-color var(--transition-fast);
	touch-action: manipulation;
	white-space: nowrap;
}

button:hover {
	background: var(--button-hover);
}

button.active {
	background: hsl(var(--accent));
	color: #000;
	border-color: hsl(var(--accent-active));
}

button.active [class*="ln-icon-"]::before {
	filter: brightness(0);
}

button.btn--sm {
	padding: 0.3rem 0.6rem;
	font-size: 0.75rem;
}

button.btn--ghost {
	background: transparent;
	border-color: transparent;
}

button.btn--ghost:hover {
	background: rgba(255, 255, 255, 0.08);
}

button.btn--danger:hover {
	background: hsl(var(--cue) /0.2);
	border-color: hsl(var(--cue));
}

/* --- LED Button (Loop toggle) --- */

.btn--led {
	position: relative;
	padding-left: 1.6rem;
}

.led-indicator {
	position: absolute;
	left: 0.5rem;
	top: 50%;
	transform: translateY(-50%);
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: var(--text-dim);
	border: 1px solid rgba(255, 255, 255, 0.1);
	transition: background var(--transition-fast), box-shadow var(--transition-fast);
}

button.active .led-indicator {
	background: hsl(var(--accent));
	box-shadow: 0 0 8px hsl(var(--accent)), 0 0 16px hsl(var(--accent) / 0.3);
}

/* --- Loop Segment Buttons Strip --- */

.loop-segments {
	display: flex;
	flex-wrap: wrap;
	gap: var(--gap-xs);
}

.loop-segments:empty {
	display: none;
}

.loop-seg-btn {
	display: inline-flex;
	align-items: stretch;
	gap: 0;
	padding: 0;
	font-size: 0.75rem;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.04em;
	border-radius: var(--radius);
	background: transparent;
	border: 1px solid hsl(var(--accent));
	color: hsl(var(--accent));
	cursor: pointer;
	touch-action: manipulation;
	min-height: 44px;
	position: relative;
	overflow: hidden;
	transition: background var(--transition-fast), color var(--transition-fast);
}

.loop-seg-label {
	display: inline-flex;
	align-items: center;
	gap: 0.4rem;
	padding: 0.4rem 0.75rem;
	padding-left: 1.4rem;
}

.loop-seg-btn .led-indicator {
	left: 0.45rem;
}

.loop-seg-btn:hover {
	background: hsl(var(--accent) / 0.15);
}

.loop-seg-btn.active {
	background: hsl(var(--accent) / 0.2);
	border-color: hsl(var(--accent));
	color: hsl(var(--accent));
}

.loop-seg-btn.active .led-indicator {
	background: hsl(var(--accent));
	box-shadow: 0 0 8px hsl(var(--accent)), 0 0 16px hsl(var(--accent) / 0.3);
}

.loop-seg-remove {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding: 0;
	background: hsl(var(--cue) /0.15);
	border: none;
	border-left: 1px solid hsl(var(--cue) /0.3);
	min-width: 40px;
	min-height: auto;
	cursor: pointer;
	transition: background var(--transition-fast);
}

.loop-seg-remove .ln-icon-close::before {
	width: 0.9rem;
	height: 0.9rem;
	filter: brightness(0) saturate(100%) invert(40%) sepia(80%) saturate(2000%) hue-rotate(335deg);
}

.loop-seg-remove:hover {
	background: hsl(var(--cue) /0.35);
}

/* ==========================================================================
   8. MODALS — overrides (base from ln-acme-modal.css)
   ========================================================================== */

.ln-modal {
	background-color: rgba(0, 0, 0, 0.75);
}

.ln-modal__content {
	max-width: 700px;
	width: 90vw;
	max-height: 85vh;
	overflow: hidden;
}

.ln-modal header h2 {
	font-size: var(--text-base);
	font-weight: var(--font-semibold);
	color: var(--color-text-primary);
	margin: 0;
}

.ln-modal main {
	max-height: 60vh;
}

#modal-track-library main {
	height: 60vh;
	display: flex;
	flex-direction: column;
}

.ln-modal footer {
	justify-content: space-between;
	align-items: center;
}

/* --- Loop Range Display --- */

.loop-range-display {
	display: block;
	font-family: var(--font-mono);
	font-size: 1.1rem;
	color: hsl(var(--loop));
	margin-bottom: var(--gap-md);
}

/* --- New Playlist Dialog --- */

.form-field {
	display: flex;
	flex-direction: column;
	gap: var(--gap-sm);
}

.form-field label {
	font-size: 0.85rem;
	color: var(--text-muted);
	font-weight: 600;
}

.form-field input[type="text"] {
	background: var(--input-bg);
	border: 1px solid var(--input-border);
	border-radius: var(--radius-sm);
	color: var(--text);
	padding: 0.5rem 0.75rem;
	font-size: 0.9rem;
	font-family: var(--font-main);
}

.form-field input[type="text"]::placeholder {
	color: var(--text-dim);
}

/* --- Library Dialog --- */

.library-search {
	display: flex;
	align-items: center;
	gap: var(--gap-sm);
	margin-bottom: var(--gap-md);
}

.library-search input[type="search"] {
	flex: 1;
	background: var(--input-bg);
	border: 1px solid var(--input-border);
	border-radius: var(--radius-sm);
	color: var(--text);
	padding: 0.5rem 0.75rem;
	font-size: 0.875rem;
	font-family: var(--font-main);
}

.library-search input[type="search"]::placeholder {
	color: var(--text-dim);
}

[data-ln-search-hide] {
	display: none !important;
}

.library-list > li {
	display: grid;
	grid-template-columns: 1fr auto auto;
	grid-template-rows: auto 4px;
	align-items: center;
	gap: 0 var(--gap-md);
	padding: var(--gap-sm) var(--gap-sm) 0;
	border-bottom: 1px solid var(--border-color);
}

.library-list > li .library-download-progress {
	grid-column: 1 / -1;
	grid-row: 2;
}

.library-list > li .library-uncache-btn {
	grid-column: 2;
	grid-row: 1;
}

.library-list > li [data-ln-action="add-to-playlist"] {
	grid-column: 3;
	grid-row: 1;
}

.library-list > li:last-child {
	border-bottom: none;
}

.library-track-info {
	flex: 1;
}

.library-track-info .track-name {
	font-weight: 600;
	font-size: 0.875rem;
}

.library-track-info .track-artist {
	font-size: 0.75rem;
	color: var(--text-muted);
}

/* --- Library: Download progress bar (always visible) --- */

.library-download-progress {
	height: 4px;
	width: 100%;
	border-radius: 0;
	background: var(--track-bg);
	overflow: hidden;
	margin: 0;
}

.library-download-progress > [data-ln-progress] {
	display: block;
	height: 100%;
	width: 0;
	background: hsl(var(--accent));
	border-radius: 0;
	transition: width 0.15s ease;
}

/* Cached state: green bar at 100% */
.library-list > li[data-ln-cached] .library-download-progress > [data-ln-progress] {
	background: hsl(var(--loop));
}

/* Uncache button — positioned at end of row 1, only when cached */
.library-uncache-btn {
	display: none;
	background: transparent;
	border: none;
	padding: 0.25rem;
	border-radius: var(--radius-sm);
	cursor: pointer;
	touch-action: manipulation;
	min-width: auto;
	min-height: auto;
}

.library-uncache-btn:hover,
.library-uncache-btn:active {
	background: hsl(var(--cue) /0.2);
}

.library-uncache-btn .ln-icon-remove::before {
	width: 0.85rem;
	height: 0.85rem;
}

.library-list > li[data-ln-cached] .library-uncache-btn {
	display: inline-flex;
}

/* Downloading state: hide Add button */
.library-list > li[data-ln-downloading] [data-ln-action="add-to-playlist"] {
	display: none;
}

/* --- Library: No API empty state --- */

.library-no-api {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	height: 100%;
	padding: var(--gap-xl) var(--gap-lg);
	text-align: center;
	color: var(--text-muted);
	gap: var(--gap-sm);
}

.library-no-api-icon {
	width: 64px;
	height: 64px;
	border-radius: 50%;
	background: var(--surface-raised);
	display: flex;
	align-items: center;
	justify-content: center;
	margin: 0;
}

.library-no-api-icon [class*="ln-icon-"]::before {
	width: 32px;
	height: 32px;
	opacity: 0.5;
}

.library-no-api h3 {
	font-size: 1.125rem;
	color: var(--text);
	margin: 0;
}

.library-no-api p {
	font-size: 0.875rem;
	margin: 0;
}

.library-no-api-btn {
	display: inline-flex;
	align-items: center;
	gap: 0.4rem;
	padding: 0.75rem 1.5rem;
	background: hsl(var(--accent));
	color: var(--bg);
	border: none;
	border-radius: var(--radius);
	font-size: 0.95rem;
	font-weight: 600;
	cursor: pointer;
	touch-action: manipulation;
	min-height: 48px;
}

.library-no-api-btn:hover {
	filter: brightness(1.1);
}

.library-no-api-btn [class*="ln-icon-"]::before {
	filter: brightness(0);
}

/* --- Settings Dialog --- */

.settings-form {
	display: flex;
	flex-direction: column;
	gap: var(--gap-lg);
}

.settings-form .form-field input[type="url"],
.settings-form .form-field input[type="text"] {
	background: var(--input-bg);
	border: 1px solid var(--input-border);
	border-radius: var(--radius-sm);
	color: var(--text);
	padding: 0.5rem 0.75rem;
	font-size: 0.9rem;
	font-family: var(--font-main);
	width: 100%;
}

.settings-form .form-field input::placeholder {
	color: var(--text-dim);
}

.settings-form .form-field .field-hint {
	font-size: 0.7rem;
	color: var(--text-dim);
	font-style: italic;
}

.logo-preview {
	display: flex;
	align-items: center;
	gap: var(--gap-md);
}

.logo-preview img {
	max-width: 64px;
	max-height: 64px;
	border-radius: var(--radius-sm);
	background: var(--input-bg);
	object-fit: contain;
}

.logo-preview .logo-placeholder {
	width: 64px;
	height: 64px;
	border-radius: var(--radius-sm);
	background: var(--input-bg);
	border: 1px dashed var(--input-border);
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--text-dim);
	font-size: 0.7rem;
}

/* --- Settings: Audio cache info --- */

.cache-info {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: var(--gap-sm);
}

.cache-info output {
	font-size: 0.875rem;
	color: var(--text-muted);
}

.cache-info button {
	white-space: nowrap;
}

/* --- Toast — overrides (base from ln-acme-toast.css) --- */

:root {
	--ln-toast-bg: var(--surface);
	--ln-toast-fg: var(--text);
	--ln-toast-fg-muted: var(--text-muted);
	--ln-toast-border: var(--border-color);
	--ln-toast-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
	--ln-toast-info: hsl(var(--accent));
}

[data-ln-toast] {
	top: auto;
	right: auto;
	bottom: 1.5rem;
	left: 50%;
	transform: translateX(-50%);
}

[data-ln-toast] > .ln-toast__item {
	transform: translateY(20px);
}

[data-ln-toast] > .ln-toast__item--in {
	transform: translateY(0);
}

.ln-toast__card {
	min-width: 280px;
	max-width: 380px;
}

.ln-toast__side {
	flex: 0 0 48px;
	padding-top: 0.75rem;
}

.ln-toast__side svg {
	width: 24px;
	height: 24px;
	color: #000;
}

.ln-toast__content {
	padding: 0.75rem 0.75rem 0.75rem 0.6rem;
}

.ln-toast__title {
	font-size: 0.875rem;
}

.ln-toast__body {
	margin-top: 0.25rem;
	font-size: 0.8rem;
	line-height: 1.4;
}

/* --- Branding in topbar --- */

.brand {
	display: flex;
	align-items: center;
	gap: var(--gap-sm);
}

.brand img {
	width: 32px;
	height: 32px;
	border-radius: var(--radius-sm);
	object-fit: contain;
}

/* --- Track added flash in sidebar --- */

.track-list > li.just-added > .track-content {
	animation: flash-added 0.6s ease;
}

@keyframes flash-added {
	0%   { background: hsl(var(--accent) /0.3); }
	100% { background: var(--surface-sunken); }
}

/* --- Swipe-to-Delete --- */

.track-list > li[data-ln-swiping] {
	background: hsl(var(--cue));
}

.track-list > li[data-ln-swiping] .track-content {
	will-change: transform;
}

.track-list > li[data-ln-swiping]::after {
	content: 'Delete';
	position: absolute;
	top: 0;
	right: 0;
	bottom: 0;
	display: flex;
	align-items: center;
	padding-right: var(--gap-lg);
	color: #fff;
	font-size: 0.75rem;
	font-weight: 700;
	text-transform: uppercase;
	letter-spacing: 0.05em;
	z-index: 0;
}

.track-list > li[data-ln-swiping]::before {
	content: '';
	position: absolute;
	right: calc(var(--gap-lg) + 3rem);
	top: 50%;
	transform: translateY(-50%);
	width: 1.25rem;
	height: 1.25rem;
	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='3 6 5 6 21 6'/%3E%3Cpath d='M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2'/%3E%3C/svg%3E");
	background-size: contain;
	background-repeat: no-repeat;
	z-index: 0;
}

.track-list > li[data-ln-swipe-committed] {
	transition: max-height 0.25s ease-out, opacity 0.2s ease-out;
	max-height: 0 !important;
	opacity: 0;
	overflow: hidden;
}

/* --- Playlist Delete Button --- */

.playlist-name {
	flex: 1;
	min-width: 0;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.playlist-delete-btn {
	flex-shrink: 0;
	width: 2rem;
	height: 2rem;
	display: flex;
	align-items: center;
	justify-content: center;
	background: transparent;
	border: none;
	opacity: 0.3;
	transition: opacity var(--transition-fast);
	touch-action: manipulation;
	margin-left: auto;
	padding: 0;
	cursor: pointer;
}

.playlist-delete-btn::before {
	width: 0.85rem;
	height: 0.85rem;
}

.playlist-group.open > header .playlist-delete-btn {
	opacity: 0.5;
}

.playlist-delete-btn:hover {
	opacity: 1 !important;
}

.playlist-delete-btn:hover::before {
	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff4444' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='3 6 5 6 21 6'/%3E%3Cpath d='M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2'/%3E%3C/svg%3E");
}

/* ==========================================================================
   9. UTILITY
   ========================================================================== */

.sr-only {
	position: absolute;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0, 0, 0, 0);
	white-space: nowrap;
	border: 0;
}

[hidden] {
	display: none !important;
}

/* ==========================================================================
   10. RESPONSIVE
   ========================================================================== */

@media (max-width: 900px) {
	.main-area {
		grid-template-columns: 1fr;
		grid-template-rows: 1fr auto;
	}

	.sidebar {
		border-left: none;
		border-top: 1px solid var(--border-color);
		max-height: 35vh;
	}
}

@media (pointer: coarse) {
	button {
		min-height: var(--touch-min);
		min-width: var(--touch-min);
	}

	.track-content {
		padding: var(--gap-md);
	}
}
